# Render Deployment Fix Guide

## Problem
Backend deployment gets stuck after "Build successful" on Render.

## Root Cause
1. Server was not binding to `0.0.0.0` (required by Render)
2. Missing health check path in render.yaml
3. MongoDB connection timeout issues

## ‚úÖ Fixes Applied

### 1. Server Binding Fix (server.js)
**Changed:** Server now binds to `0.0.0.0` instead of localhost
```javascript
const HOST = '0.0.0.0'; // Bind to all network interfaces for Render
app.listen(PORT, HOST, () => {
  console.log(`QuickSnack server running on ${HOST}:${PORT}`);
});
```

### 2. Health Check Path (render.yaml)
**Added:** Health check endpoint for Render to verify service is ready
```yaml
healthCheckPath: /api/health
```

### 3. MongoDB Connection Improvements
**Added:** Timeout and better error logging
```javascript
mongoose.connect(process.env.MONGO_URI, {
  serverSelectionTimeoutMS: 5000,
})
```

## üöÄ Deployment Steps

### Step 1: Commit Changes
```bash
git add .
git commit -m "Fix Render deployment - bind to 0.0.0.0 and add health check"
git push origin main
```

### Step 2: Redeploy on Render
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Select your `quicksnack-backend` service
3. Click **"Manual Deploy"** ‚Üí **"Deploy latest commit"**
4. Wait for deployment (should complete in 2-3 minutes)

### Step 3: Verify Deployment
Check these URLs:
- **Root:** `https://quicksnack-final-backend.onrender.com/`
- **Health:** `https://quicksnack-final-backend.onrender.com/api/health`

Expected response from health endpoint:
```json
{
  "status": "OK",
  "message": "QuickSnack API is running"
}
```

## üîç Troubleshooting

### If Still Stuck After Build

**Check Logs:**
1. Go to Render Dashboard ‚Üí Your Service ‚Üí Logs
2. Look for these messages:
   - ‚úÖ `QuickSnack server running on 0.0.0.0:10000`
   - ‚úÖ `Connected to MongoDB Atlas`
   - ‚ùå Any error messages

**Common Issues:**

#### MongoDB Connection Failed
```
Error: Check MONGO_URI environment variable
Solution: Verify MongoDB Atlas IP whitelist includes 0.0.0.0/0
```

#### Port Already in Use
```
Error: EADDRINUSE
Solution: Render will auto-assign port, ensure you're using process.env.PORT
```

#### Missing Environment Variables
```
Error: JWT_SECRET is not defined
Solution: Add all required env vars in Render dashboard
```

## üìã Required Environment Variables on Render

Make sure these are set in Render Dashboard ‚Üí Service ‚Üí Environment:

```env
NODE_ENV=production
MONGO_URI=mongodb+srv://QuickSnack:QuickSnack%4037@quicksnack.wmea4h4.mongodb.net/?retryWrites=true&w=majority&appName=QuickSnack
JWT_SECRET=<auto-generated-by-render>
JWT_EXPIRES_IN=7d
RESEND_API_KEY=<your-resend-api-key>
EMAIL_USER=vyomverma2873@gmail.com
FRONTEND_URL=<will-be-set-after-frontend-deploys>
```

## ‚úÖ Success Indicators

Your deployment is successful when you see:
1. ‚úÖ Build completes
2. ‚úÖ "Live" badge appears on service
3. ‚úÖ Health check returns 200 OK
4. ‚úÖ Logs show: "QuickSnack server running on 0.0.0.0:10000"
5. ‚úÖ Logs show: "Connected to MongoDB Atlas"

## üéØ Next Steps After Backend is Live

1. **Note Backend URL:** Copy from Render dashboard
2. **Deploy Frontend:** Use backend URL in NEXT_PUBLIC_API_BASE_URL
3. **Update CORS:** Backend will auto-allow Vercel domains
4. **Test API:** Make test requests to verify all endpoints work

## üìû Still Having Issues?

If deployment still fails:
1. Check Render logs for specific error messages
2. Verify MongoDB Atlas network access allows all IPs (0.0.0.0/0)
3. Ensure all environment variables are set correctly
4. Try manual deploy instead of auto-deploy
5. Contact Render support with error logs

---

**Last Updated:** Oct 29, 2025
**Status:** Fixed and Ready to Deploy
